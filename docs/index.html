<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dr. Ieuan Higgs â€“ Earth System AI</title>

  <!-- Import shared site-wide styles -->
  <link rel="stylesheet" href="/style.css">

  <!-- Header styles (same as homepage header) -->
  <link rel="stylesheet" href="/assets/css/header.css">


  <!-- Page-specific styling -->
  <style>
    /* Page content layout */
    .page {
      position:absolute;
      inset: var(--header-h) 0 0 0;
      display:flex;
      align-items:center;
      justify-content:center;
      gap: 2rem;
      overflow:hidden;
    }

    .globe-wrap{
      pointer-events:auto;
      flex:1;
      min-width:300px;
      max-width:800px;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding:12px;
    }

    #globe{
      width:100%;
      height:100%;
      display:block;
      border-radius:14px;
      background: radial-gradient(circle at 40% 30%, rgba(255,255,255,0.01), transparent 20%);
    }

    /* Floating bubbles */
    .bubble{
      position:absolute;
      pointer-events:none;
      max-width:260px;
      padding:12px 16px;
      border-radius:16px;
      font-size:20px;
      line-height:1.3;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 20px rgba(2,6,23,0.6);
      animation: floaty 5.5s ease-in-out infinite;
      color:#e9f1ff;
      z-index:30;
      text-align: center;
    }
    @keyframes floaty{
      0%{ transform:translateY(0) scale(1);}
      50%{ transform:translateY(-8px) scale(1.01);}
      100%{ transform:translateY(0) scale(1);}
    }
    .bubble1{ top:8%; left:6%; animation-delay:0s;}
    .bubble2{ bottom:12%; left:4%; animation-delay:1.1s;}
    .bubble3{ top:10%; right:6%; animation-delay:0.6s;}
  </style>
</head>



<body>
  <!-- Header imported dynamically -->
  <div id="header-container"></div>


  
  <!-- Page content -->
  <div class="page">
    <div class="globe-wrap" id="globe-wrap">
      <svg id="globe" viewBox="0 0 960 960" preserveAspectRatio="xMidYMid meet"></svg>
    </div>

    <!-- Bubbles -->
    <div class="bubble bubble1">Using AI to improve Earth system prediction</div>
    <div class="bubble bubble2">Combining data assimilation with machine learning</div>
    <div class="bubble bubble3">Building trust in AI with explainability methods</div>
  </div>

  <!-- Import D3 + topojson -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3/dist/topojson-client.min.js"></script>



  <!-- Import shared header -->
  <script>
    fetch('assets/html/header.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('header-container').innerHTML = html;

        // Re-attach dropdown behavior
        const toggle = document.getElementById('dropdownToggle');
        const menu = document.getElementById('dropdownMenu');
        if(toggle && menu){
          toggle.addEventListener('click', e => {
            e.stopPropagation();
            menu.style.display = (menu.style.display==='block')?'none':'block';
          });
          document.addEventListener('click', () => menu.style.display='none');
          document.addEventListener('keydown', e => { if(e.key==='Escape') menu.style.display='none'; });
        }
      });
  </script>



  <!-- Globe script -->
  <script>
    const viewBoxSize = 960;
    const svg = d3.select('#globe')
      .attr('viewBox', `0 0 ${viewBoxSize} ${viewBoxSize}`)
      .attr('preserveAspectRatio', 'xMidYMid meet');

    let projection = d3.geoOrthographic()
      .scale((viewBoxSize / 2) - 20)
      .translate([viewBoxSize / 2, viewBoxSize / 2])
      .clipAngle(90);

    let path = d3.geoPath(projection);
    const g = svg.append('g');

    const globeCircle = g.append('circle')
      .attr('cx', viewBoxSize / 2)
      .attr('cy', viewBoxSize / 2)
      .attr('r', projection.scale())
      .attr('fill', '#092e6e');

    const graticule = d3.geoGraticule10();
    g.append('path')
      .datum(graticule)
      .attr('d', path)
      .attr('fill','none')
      .attr('stroke','rgba(255,255,255,0.04)')
      .attr('stroke-width',0.5);

    const countriesG = g.append('g').attr('class','countries');

    function randomRed(){ return `rgb(${20+Math.random()*50},${120+Math.random()*60},${10+Math.random()*40})`; }

    d3.json('countries-110m.json').then(world=>{
      const land = topojson.feature(world, world.objects.countries);
      const colorById = new Map();
      land.features.forEach(f=>colorById.set(f.id, randomRed()));

      countriesG.selectAll('path')
        .data(land.features)
        .enter().append('path')
        .attr('d',path)
        .attr('fill', d=>colorById.get(d.id))
        .attr('stroke','rgba(0,0,0,0.25)')
        .attr('stroke-width',0.3);

      countriesG.append('path')
        .datum({type:'Sphere'})
        .attr('d', path)
        .attr('fill','none')
        .attr('stroke','rgba(255,255,255,0.06)')
        .attr('stroke-width',1.2);

      startInteraction();
    });

    let rotation=[0,-20,0], velocity=0.02, lastTime=Date.now(), dragging=false, inertia={vx:0,vy:0,lastT:0};
    function render(){ projection.rotate(rotation); svg.selectAll('path').attr('d', path); }
    function tick(){
      const now=Date.now(), dt=now-lastTime; lastTime=now;
      if(!dragging){ rotation[0]+=velocity*dt; } 
      else{ if(Math.abs(inertia.vx)>0.00001||Math.abs(inertia.vy)>0.00001){ rotation[0]+=inertia.vx*dt; rotation[1]+=inertia.vy*dt; inertia.vx*=Math.exp(-0.002*dt); inertia.vy*=Math.exp(-0.002*dt); } }
      rotation[1]=Math.max(-90,Math.min(90,rotation[1]));
      render();
      requestAnimationFrame(tick);
    }

    function startInteraction(){
      const drag=d3.drag()
        .on('start', e=>{ dragging=true; inertia.vx=inertia.vy=0; svg.classed('grabbing',true).classed('grab',false); })
        .on('drag', e=>{
          const sens=0.25, dx=e.dx*sens, dy=e.dy*sens;
          rotation[0]+=dx; rotation[1]-=dy;
          const now=Date.now(), dt=Math.max(1, now-(inertia.lastT||now));
          inertia.vx=dx/dt; inertia.vy=-dy/dt; inertia.lastT=now;
          render();
        })
        .on('end', e=>{ dragging=false; svg.classed('grabbing',false).classed('grab',true); });
      svg.call(drag).classed('grab',true);
      lastTime=Date.now(); requestAnimationFrame(tick);
    }

    function resize(){
      const wrap=document.getElementById('globe-wrap'), rect=wrap.getBoundingClientRect();
      const s=Math.min(rect.width,rect.height)/2-10;
      projection.scale(s).translate([viewBoxSize/2, viewBoxSize/2]);
      globeCircle.attr('cx',viewBoxSize/2).attr('cy',viewBoxSize/2).attr('r',s);
      path=d3.geoPath(projection); svg.selectAll('path').attr('d',path);
    }
    const observer=new ResizeObserver(resize);
    observer.observe(document.getElementById('globe-wrap'));
    window.addEventListener('resize', resize);
    setTimeout(resize,50);
  </script>
</body>
</html>
