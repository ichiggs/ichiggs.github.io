<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dr. Ieuan Higgs â€“ Earth System AI</title>

  <!-- Import shared site-wide styles -->
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="/assets/css/header.css">

  <!-- Page-specific styling -->
  <style>
    .page {
      position: absolute;
      inset: var(--header-h) 0 0 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4rem;
      overflow: hidden;
      padding: 2rem;
    }

    .globe-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .globe-wrap {
      pointer-events:auto;
      width: 100%;
      max-width: 1000px;
      aspect-ratio:1/1;
      display:flex;
      align-items:center;
      justify-content:center;
      position: relative;
      padding: 12px;
    }

    .globe-heading {
      position:absolute;
      pointer-events:none;
      max-width:260px;
      padding:12px 16px;
      border-radius:16px;
      font-size:24px;
      line-height:1.3;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 20px rgba(2,6,23,0.6);
      color:#e9f1ff;
      z-index:30;
      text-align: center;
    }

    #globe {
      width:100%;
      height:100%;
      display:block;
      border-radius:14px;
      background: radial-gradient(circle at 40% 30%, rgba(255,255,255,0.01), transparent 20%);
    }

    .bubble {
      position:absolute;
      pointer-events:none;
      max-width:260px;
      padding:12px 16px;
      border-radius:16px;
      font-size:20px;
      line-height:1.3;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 20px rgba(2,6,23,0.6);
      animation: floaty 5.5s ease-in-out infinite;
      color:#e9f1ff;
      z-index:30;
      text-align: center;
    }

    @keyframes floaty {
      0%{ transform:translateY(0) scale(1);}
      50%{ transform:translateY(-8px) scale(1.01);}
      100%{ transform:translateY(0) scale(1);}
    }

    .bubble1{ top:28%; left:15%; animation-delay:0s;}
    .bubble2{ top:70%; left:20%; animation-delay:1.1s;}
    .bubble3{ top:28%; right:15%; animation-delay:0.6s;}
    .bubble4{ top:70%; right:20%; animation-delay:1.5s;}
    .globe-heading{ top:15%; animation-delay:0.6s;}
  </style>
</head>

<body>
  <!-- Header imported dynamically -->
  <div id="header-container"></div>

  

  <!-- Page content -->
  <div class="page">
    <div class="globe-container">

      

      <div class="globe-wrap" id="globe-wrap">
        <svg id="globe" viewBox="0 0 1960 1960" preserveAspectRatio="xMidYMid meet"></svg>
      </div>

      <div class="globe-heading">Research Interests</div>

      <!-- Bubbles -->
      <div class="bubble bubble1">Using AI to improve Earth system prediction</div>
      <div class="bubble bubble2">Combining data assimilation with machine learning</div>
      <div class="bubble bubble3">Building trust in AI with explainability methods</div>
      <div class="bubble bubble4">Marine Biogeochemistry and Urban Meteorology</div>
    </div>
  </div>

  <!-- Import D3 + topojson -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3/dist/topojson-client.min.js"></script>

  <!-- Import shared header -->
  <script>
    fetch('assets/html/header.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('header-container').innerHTML = html;
        const toggle = document.getElementById('dropdownToggle');
        const menu = document.getElementById('dropdownMenu');
        if(toggle && menu){
          toggle.addEventListener('click', e => {
            e.stopPropagation();
            menu.style.display = (menu.style.display==='block')?'none':'block';
          });
          document.addEventListener('click', () => menu.style.display='none');
          document.addEventListener('keydown', e => { if(e.key==='Escape') menu.style.display='none'; });
        }
      });
  </script>

  <!-- Globe + 3D orbiting image script -->
  <script>
    const viewBoxSize_h = 1960;
    const viewBoxSize_w = 1960;
    const svg = d3.select('#globe')
      .attr('viewBox', `0 0 ${viewBoxSize_w} ${viewBoxSize_h}`)
      .attr('preserveAspectRatio', 'xMidYMid meet');

    let projection = d3.geoOrthographic()
      .scale((viewBoxSize_w / 2) - 20)
      .translate([viewBoxSize_w / 2, viewBoxSize_h / 2])
      .clipAngle(90);

    let path = d3.geoPath(projection);
    const g = svg.append('g');

    const globeCircle = g.append('circle')
      .attr('cx', viewBoxSize_w / 2)
      .attr('cy', viewBoxSize_h / 2)
      .attr('r', projection.scale())
      .attr('fill', '#092e6e');

    const graticule = d3.geoGraticule10();
    g.append('path')
      .datum(graticule)
      .attr('d', path)
      .attr('fill','none')
      .attr('stroke','rgba(255,255,255,0.04)')
      .attr('stroke-width',0.5);

    const countriesG = g.append('g').attr('class','countries');

    function randomRed(){ return `rgb(${20+Math.random()*50},${120+Math.random()*60},${10+Math.random()*40})`; }

    d3.json('countries-110m.json').then(world=>{
      const land = topojson.feature(world, world.objects.countries);
      const colorById = new Map();
      land.features.forEach(f=>colorById.set(f.id, randomRed()));

      countriesG.selectAll('path')
        .data(land.features)
        .enter().append('path')
        .attr('d',path)
        .attr('fill', d=>colorById.get(d.id))
        .attr('stroke','rgba(0,0,0,0.25)')
        .attr('stroke-width',0.3);

      countriesG.append('path')
        .datum({type:'Sphere'})
        .attr('d', path)
        .attr('fill','none')
        .attr('stroke','rgba(255,255,255,0.06)')
        .attr('stroke-width',1.2);

      startInteraction();
    });

    let rotation=[0,-20,0], velocity=0.02, lastTime=Date.now(), dragging=false, inertia={vx:0,vy:0,lastT:0};
    function render(){ projection.rotate(rotation); svg.selectAll('path').attr('d', path); }
    function tick(){
      const now=Date.now(), dt=now-lastTime; lastTime=now;
      if(!dragging){ rotation[0]+=velocity*dt; } 
      else{ if(Math.abs(inertia.vx)>0.00001||Math.abs(inertia.vy)>0.00001){ rotation[0]+=inertia.vx*dt; rotation[1]+=inertia.vy*dt; inertia.vx*=Math.exp(-0.002*dt); inertia.vy*=Math.exp(-0.002*dt); } }
      rotation[1]=Math.max(-90,Math.min(90,rotation[1]));
      render();
      requestAnimationFrame(tick);
    }

    function startInteraction(){
      const drag=d3.drag()
        .on('start', e=>{ dragging=true; inertia.vx=inertia.vy=0; svg.classed('grabbing',true).classed('grab',false); })
        .on('drag', e=>{
          const sens=0.25, dx=e.dx*sens, dy=e.dy*sens;
          rotation[0]+=dx; rotation[1]-=dy;
          const now=Date.now(), dt=Math.max(1, now-(inertia.lastT||now));
          inertia.vx=dx/dt; inertia.vy=-dy/dt; inertia.lastT=now;
          render();
        })
        .on('end', e=>{ dragging=false; svg.classed('grabbing',false).classed('grab',true); });
      svg.call(drag).classed('grab',true);
      lastTime=Date.now(); requestAnimationFrame(tick);
    }

    function resize(){
      const wrap=document.getElementById('globe-wrap'), rect=wrap.getBoundingClientRect();
      const s=Math.min(rect.width,rect.height)/2-10;
      projection.scale(s).translate([viewBoxSize_w/2, viewBoxSize_h/2]);
      globeCircle.attr('cx',viewBoxSize_w/2).attr('cy',viewBoxSize_h/2).attr('r',s);
      path=d3.geoPath(projection); svg.selectAll('path').attr('d',path);
    }
    const observer=new ResizeObserver(resize);
    observer.observe(document.getElementById('globe-wrap'));
    window.addEventListener('resize', resize);
    setTimeout(resize,50);

    // --- Orbiting profile image in 3D ---
    const orbitRadius = projection.scale() - 70; 
    const imgSize = 90;

    const orbitImage = svg.append("image")
      .attr("href", "assets/img/ieuan_higgs_photo_close.png")
      .attr("width", imgSize)
      .attr("height", imgSize)
      .attr("x", viewBoxSize_w/2 - imgSize/2)
      .attr("y", viewBoxSize_h/2 - orbitRadius - imgSize/2)
      .attr("clip-path","circle(50%)");

    let orbitAngle = 0;

    function animateOrbit3D(){
      orbitAngle -= 0.2; // speed
      const rad = orbitAngle * Math.PI / 180;

      // 3D orbit around globe
      const x = viewBoxSize_w/2 + orbitRadius * Math.cos(rad);
      const z = orbitRadius * Math.sin(rad); // depth
      const y = viewBoxSize_h/2 + z * 0.3; // perspective squash

      // scale smaller when behind
      const scale = (1 + z / (orbitRadius*4))*2;
      const size = imgSize * scale;

      orbitImage
        .attr("x", x - size/2)
        .attr("y", y - size/2)
        .attr("width", size)
        .attr("height", size);

      // layer behind if behind globe
      if(z < 0){
        orbitImage.lower();
      } else {
        orbitImage.raise();
      }

      requestAnimationFrame(animateOrbit3D);
    }

    animateOrbit3D();
  </script>
</body>
</html>
