<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dr. Ieuan Higgs – Earth System AI</title>

  <style>
    :root{
      --bg-1: #0b1220;
      --bg-2: #05070d;
      --header-h: 128px;
      --accent: #d9e2ff;
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(circle at 30% 20%, rgba(10,18,32,0.8), rgba(3,6,10,1) 60%), linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#fff;
      overflow: hidden;
    }

    /* Header (fixed) */
    header.app-header{
      position:fixed;
      top:0;
      left:0;
      right:0;
      height:var(--header-h);
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 28px;
      gap:12px;
      z-index:100;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.005));
      border-bottom: 1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(8px) saturate(1.05);
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }
    header .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    header h1{
      margin:0;
      font-size:40px;
      font-weight:700;
    }
    .brand-link {
      color: inherit;           /* keeps the header color */
      text-decoration: none;    /* removes underline */
      cursor: pointer;          /* makes it obvious it’s clickable */
    }

    .brand-link:hover {
      color: #fff;              /* optional: change color on hover */
    }
    header p.small{
      margin:0;
      font-size:24px;
      color:rgba(217,226,255,0.75);
    }

    nav.top-nav{
      display:flex;
      gap:18px;
      align-items:center;
      font-size:20px;
      position: relative;
      z-index: 101; /* above globe */
    }

    nav.top-nav a{
      color:var(--accent);
      text-decoration:none;
      padding:8px 10px;
      border-radius:8px;
      transition: background .18s, color .18s;
    }
    nav.top-nav a:hover{ background: rgba(255,255,255,0.03); color:#fff; }

    /* Dropdown container */
    .dropdown {
      position: relative;
    }

    /* Dropdown menu */
    .dropdown .menu {
      position: absolute;
      top:calc(var(--header-h) - 16px);
      right:0;
      min-width:200px;
      background: rgba(8,10,14,0.95);
      border-radius:10px;
      padding: 8px 0;
      box-shadow:0 8px 30px rgba(0,0,0,0.6);
      display:none;
      backdrop-filter: blur(6px);
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* Menu items */
    .dropdown .menu a{
      display:block;
      padding:8px 14px;
      color:#d9e2ff;
      text-decoration:none;
      font-size:14px;
      border-radius:6px;
    }
    .dropdown .menu a:hover{
      background: rgba(255,255,255,0.03);
      color:#fff;
    }

    /* Page content below header */
    .page{
      position:absolute;
      inset: var(--header-h) 0 0 0;
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      pointer-events:auto;
    }

    /* Globe wrapper */
    .globe-wrap{
      pointer-events:auto;
      width: clamp(300px, 60vw, 820px);
      aspect-ratio:1/1;
      max-height: calc(100vh - var(--header-h) - 48px);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      padding:12px;
    }

    #globe{
      width:100%;
      height:100%;
      display:block;
      border-radius:14px;
      background: radial-gradient(circle at 40% 30%, rgba(255,255,255,0.01), transparent 20%);
    }

    /* Floating bubbles */
    .bubble{
      position:absolute;
      pointer-events:none;
      max-width:260px;
      padding:12px 16px;
      border-radius:16px;
      font-size:20px;
      line-height:1.3;
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
      box-shadow:0 6px 20px rgba(2,6,23,0.6);
      animation: floaty 5.5s ease-in-out infinite;
      color:#e9f1ff;
      z-index:30;
      text-align: center; /* center text horizontally */
    }
    @keyframes floaty{
      0%{ transform:translateY(0) scale(1);}
      50%{ transform:translateY(-8px) scale(1.01);}
      100%{ transform:translateY(0) scale(1);}
    }
    .bubble1{ top:8%; left:6%; animation-delay:0s;}
    .bubble2{ bottom:12%; left:4%; animation-delay:1.1s;}
    .bubble3{ top:10%; right:6%; animation-delay:0.6s;}

    /* Credits */
    .credits{
      position:absolute;
      bottom:8px;
      left:50%;
      transform:translateX(-50%);
      font-size:12px;
      color: rgba(217,226,255,0.6);
      pointer-events:none;
      z-index:20;
    }
  </style>
</head>

<body>
  <!-- Header -->
  <header class="app-header">
    <div class="brand">
      <div>
        <h1><a href="/" class="brand-link">Dr. Ieuan Higgs</a></h1>
        <p class="small">Lecturer in Computer Science, University of Reading</p>
        <!--p class="small">Research: Earth systems • Data assimilation • Explainable AI</p-->
      </div>
    </div>

    <nav class="top-nav">
      <a href="https://scholar.google.com/citations?user=yYNEUSIAAAAJ&hl=en&oi=ao">Google Scholar</a>

      <a href="about">About Me</a>

      <div class="dropdown">
        <a id="dropdownToggle">Demos ▾</a>
        <div class="menu" id="dropdownMenu">
          <a href="#globe-demo">Globe Visualisation</a>
          <a href="#assimilation">AI Assimilation</a>
          <a href="#xai">Explainable AI</a>
        </div>
      </div>
    </nav>
  </header>

  <!-- Page content -->
  <div class="page">
    <div class="globe-wrap" id="globe-wrap">
      <svg id="globe" viewBox="0 0 960 960" preserveAspectRatio="xMidYMid meet"></svg>
      <!--div class="credits">Uses D3.js & topojson (network required)</div-->
    </div>

    <!-- Bubbles -->
    <div class="bubble bubble1">Using AI to improve Earth system prediction</div>
    <div class="bubble bubble2">Combining data assimilation with machine learning</div>
    <div class="bubble bubble3">Building trust in AI with explainability methods</div>
  </div>

  <!-- D3 and topojson -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://unpkg.com/topojson-client@3/dist/topojson-client.min.js"></script>

  <!-- Dropdown click behavior -->
  <script>
    const toggle = document.getElementById('dropdownToggle');
    const menu = document.getElementById('dropdownMenu');

    toggle.addEventListener('click', (e) => {
      e.stopPropagation();
      menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!menu.contains(e.target) && !toggle.contains(e.target)) {
        menu.style.display = 'none';
      }
    });

    // Optional: close on ESC key
    document.addEventListener('keydown', (e) => {
      if(e.key === "Escape") menu.style.display='none';
    });
  </script>

  <!-- Globe script (same as your previous working version) -->
  <script>
    const viewBoxSize = 960;
    const svg = d3.select('#globe')
      .attr('viewBox', `0 0 ${viewBoxSize} ${viewBoxSize}`)
      .attr('preserveAspectRatio', 'xMidYMid meet');

    let projection = d3.geoOrthographic()
      .scale((viewBoxSize / 2) - 20)
      .translate([viewBoxSize / 2, viewBoxSize / 2])
      .clipAngle(90);

    let path = d3.geoPath(projection);
    const g = svg.append('g');

    const globeCircle = g.append('circle')
      .attr('cx', viewBoxSize / 2)
      .attr('cy', viewBoxSize / 2)
      .attr('r', projection.scale())
      .attr('fill', '#021323');

    const graticule = d3.geoGraticule10();
    g.append('path')
      .datum(graticule)
      .attr('d', path)
      .attr('fill','none')
      .attr('stroke','rgba(255,255,255,0.04)')
      .attr('stroke-width',0.5);

    const countriesG = g.append('g').attr('class','countries');

    function randomRed(){ return `rgb(${160+Math.random()*95},${Math.random()*100},${Math.random()*100})`; }

    d3.json('countries-110m.json').then(world=>{
      const land = topojson.feature(world, world.objects.countries);
      const colorById = new Map();
      land.features.forEach(f=>colorById.set(f.id, randomRed()));

      countriesG.selectAll('path')
        .data(land.features)
        .enter().append('path')
          .attr('d',path)
          .attr('fill', d=>colorById.get(d.id))
          .attr('stroke','rgba(0,0,0,0.25)')
          .attr('stroke-width',0.3);

      countriesG.append('path')
        .datum({type:'Sphere'})
        .attr('d', path)
        .attr('fill','none')
        .attr('stroke','rgba(255,255,255,0.06)')
        .attr('stroke-width',1.2);

      startInteraction();
    });

    let rotation=[0,-20,0], velocity=0.02, lastTime=Date.now(), dragging=false, inertia={vx:0,vy:0,lastT:0};
    function render(){ projection.rotate(rotation); svg.selectAll('path').attr('d', path); }
    function tick(){
      const now=Date.now(), dt=now-lastTime; lastTime=now;
      if(!dragging){ rotation[0]+=velocity*dt; } 
      else{ if(Math.abs(inertia.vx)>0.00001||Math.abs(inertia.vy)>0.00001){ rotation[0]+=inertia.vx*dt; rotation[1]+=inertia.vy*dt; inertia.vx*=Math.exp(-0.002*dt); inertia.vy*=Math.exp(-0.002*dt); } }
      rotation[1]=Math.max(-90,Math.min(90,rotation[1]));
      render();
      requestAnimationFrame(tick);
    }

    function startInteraction(){
      const drag=d3.drag()
        .on('start', e=>{ dragging=true; inertia.vx=inertia.vy=0; svg.classed('grabbing',true).classed('grab',false); })
        .on('drag', e=>{
          const sens=0.25, dx=e.dx*sens, dy=e.dy*sens;
          rotation[0]+=dx; rotation[1]-=dy;
          const now=Date.now(), dt=Math.max(1, now-(inertia.lastT||now));
          inertia.vx=dx/dt; inertia.vy=-dy/dt; inertia.lastT=now;
          render();
        })
        .on('end', e=>{ dragging=false; svg.classed('grabbing',false).classed('grab',true); });
      svg.call(drag).classed('grab',true);
      lastTime=Date.now(); requestAnimationFrame(tick);
    }

    function resize(){
      const wrap=document.getElementById('globe-wrap'), rect=wrap.getBoundingClientRect();
      const s=Math.min(rect.width,rect.height)/2-10;
      projection.scale(s).translate([viewBoxSize/2, viewBoxSize/2]);
      globeCircle.attr('cx',viewBoxSize/2).attr('cy',viewBoxSize/2).attr('r',s);
      path=d3.geoPath(projection); svg.selectAll('path').attr('d',path);
    }
    const observer=new ResizeObserver(resize);
    observer.observe(document.getElementById('globe-wrap'));
    window.addEventListener('resize', resize);
    setTimeout(resize,50);
  </script>
</body>
</html>
